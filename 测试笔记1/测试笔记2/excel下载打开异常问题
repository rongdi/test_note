<p>&nbsp; &nbsp; 使用传统的springmvc下载代码如下</p><p>&nbsp; &nbsp;&nbsp;<span style="background-color: rgb(241, 241, 241);">/**</span></p><pre><code>     * 下载导入认证会员模板（全部）<br>     */<br>    @RequestMapping("/downloadAllMasterChildTemplate")<br>    public Result&lt;?&gt; downloadAllMasterChildTemplate(@RequestParam(value = "communityId") Integer communityId,<br>                                                    HttpServletRequest request,<br>                                                    HttpServletResponse response) throws Exception {<br>        Pair&lt;org.apache.commons.io.output.ByteArrayOutputStream, String&gt; pair = null;<br>        org.apache.commons.io.output.ByteArrayOutputStream byteArrayOutputStream = null;<br>        try {<br>            if (communityId == null) {<br>                return Result.failure("社区ID不能为空");<br>            }<br><br>            String operateKey = String.format("CK_MST_EX_%s", communityId);<br>            Pair&lt;Integer, String&gt; checkPair = operateSpeedComponent.checkSpeed(operateKey, 30);<br>            if (checkPair.getLeft().equals(StatusCode.FAILURE.value())) {<br>                return Result.failure(checkPair.getRight());<br>            }<br><br>            pair = masterChildService.downloadMasterChildTemplate(communityId, null);<br>            byteArrayOutputStream = pair.getLeft();<br>            String fileName = pair.getRight();<br>            response.setContentType("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");<br>            response.setHeader("Content-disposition", "attachment;filename="<br>                + BaseUtils.handleFileName(fileName, request));<br>            IOUtils.write(bs, response.getOutputStream());<br>            logger.info("Invoke[downloadPaymentTemplate] success");<br>        } catch (Exception e) {<br>            logger.error("Invoke[downloadPaymentTemplate] error", e);<br>        } finally {<br>            if (byteArrayOutputStream != null) {<br>                byteArrayOutputStream.close();<br>            }<br>        }<br><br>        return Result.success("成功");<br>    }</code></pre><p>&nbsp;下载的excel有的电脑打开报错提示</p><p><img src="http://127.0.0.1:8888/note/attachment/f1678890-e410-43bf-9bc7-5095a9cddf67.png" style="max-width:100%;"></p><p>、有的电脑的excel版本根本打不开，需要添加如下代码</p><pre><code>byte[] bs = byteArrayOutputStream.toByteArray();<br>response.setIntHeader("Content-Length", bs.length);</code></pre><p>然后使用二进制工具打开两个excel发现差别如下</p><p><img src="http://127.0.0.1:8888/note/attachment/5a1b57d0-b1d5-4591-a01a-eaf559402997.png" style="max-width:100%;"></p><p>如上图右侧是没有添加Content-Length头多了一些二进制数据，导致有些excel版本打不开，有些excel</p><p><br></p>